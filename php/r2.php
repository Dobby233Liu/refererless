<?php function mi($fn, $mp = '.'){$fe=substr(strrchr($fn,'.'),1);if(empty($fe))return 'application/octet-stream';$regex="/^([\w\+\-\.\/]+)\s+(\w+\s)*($fe\s)/i";$lines=file("$mp/mime.types");foreach($lines as $line){if(substr($line,0,1)=='#')continue;$line=rtrim($line)." ";if(!preg_match($regex,$line,$matches))continue;return ($matches[1]);}return 'application/octet-stream';}$i=!isset($_GET['u'])?$_POST['u']:$_GET['u'];$j=mi($i);if(!$i)$i='application/octet-stream';if(!$j||!isset($j)||$j==''||substr($j,0,6)!='image/'){header('location:'.$i);}else{header("content-type:".$j);echo file_get_contents($i);}
